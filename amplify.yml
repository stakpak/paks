version: 1
applications:
  # Main web app (paks.stakpak.dev)
  - frontend:
      phases:
        preBuild:
          commands:
            - nvm use 20 && node --version
            - corepack enable && npx --yes nypm install
        build:
          commands:
            - pnpm run build --filter web
      artifacts:
        baseDirectory: apps/web/.amplify-hosting
        files:
          - '**/*'
      buildPath: /
    appRoot: apps/web
  
  # Documentation site (docs.paks.stakpak.dev)
  - frontend:
      phases:
        preBuild:
          commands:
            - nvm use 20 && node --version
            - corepack enable && npx --yes nypm install
        build:
          commands:
            - pnpm run build --filter docs
      artifacts:
        baseDirectory: apps/docs/.amplify-hosting
        files:
          - '**/*'
      buildPath: /
    appRoot: apps/docs
